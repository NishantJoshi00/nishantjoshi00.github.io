<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Building CLIs with C</title><meta content="Building CLIs with C" name=title><meta content=Nishant name=author><meta content=website property=og:type><meta content=https://nishantjoshi00.github.io/blog/college/building-clis-with-c/ property=og:url><meta property=og:site_name><meta content="Building CLIs with C" property=og:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nishantjoshi00.github.io/blog/college/building-clis-with-c/ property=twitter:url><meta content="Building CLIs with C" property=twitter:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=twitter:image><link href=https://nishantjoshi00.github.io/blog/college/building-clis-with-c/ rel=canonical><link rel="shortcut icon" href=https://nishantjoshi00.github.io/favicon.ico type=image/x-icon><link href=https://nishantjoshi00.github.io/css/style.css rel=stylesheet><script defer src=https://nishantjoshi00.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><div class=themeSwitch><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#lightMode></use></svg></button><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#darkMode></use></svg></button></div></nav></header><main><div><a href=..>..</a>/<span class=metaData>building-clis-with-c</span></div><time datetime=2020-06-06>Published on: <span class=metaData>2020-06-06</span></time><h1>Building CLIs with C</h1><h2 id=introduction>Introduction</h2><p>CLI (<strong>C</strong>ommand <strong>L</strong>ine <strong>I</strong>nterface) Application are the programs that we run on our terminal or console. All the linux command we use are CLIs e.g. <code>ls, cat, vim</code> . The programs which uses flags and values to communicate with the inherent program.<p>e.g.<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ ls -l
</span><span style=font-style:italic;color:#928374># This command displays all the files in the current directory in list format (-l : for list format)
</span></code></pre><h2 id=why-c>Why C ?</h2><p>Now, why would you use C. For building such applications.<ol><li>C is <strong>fast</strong> as compared to other programming languages<li>The source code is <strong>obfuscated</strong>.<li>C is better <strong>compatible</strong> with the <strong>kernel</strong> and runs seamlessly.</ol><h2 id=implementing-cli-with-c>Implementing CLI with C</h2><h3 id=taking-command-line-arguments>Taking Command Line Arguments</h3><p>In C the command line arguments are taken in the main function as arguments. You might have seen the syntax used somewhere before and are wondering, why it is used<pre class=language-c data-lang=c style=background:#282828;color:#fdf4c1aa><code class=language-c data-lang=c><span style=color:#fa5c4b>int </span><span style=color:#8ec07c>main</span><span>(</span><span style=color:#fa5c4b>int </span><span style=color:#fdf4c1>argc</span><span>, </span><span style=color:#fa5c4b>char</span><span style=color:#fe8019>* </span><span style=color:#fdf4c1>argv</span><span>[]) {}
</span><span style=font-style:italic;color:#928374>// This could also be void main(int argc, char* argv[]) {}
</span></code></pre><ul><li><code>argc</code>: This is the count of arguments provided to the program.<li><code>argv</code>: This is where the arguments are stored in form of character array</ul><blockquote><p>The minimum value of argc is always 1. Where the first argument is the actual name of the program that is been run. Thus the real arguments and flags start from index 1 for <code>argv</code></blockquote><p>eg.<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>cat </span><span style=color:#fe8019><< </span><span style=color:#fa5c4b>EOF </span><span style=color:#fe8019>></span><span style=color:#fdf4c1> example.c
</span><span style=color:#fdf4c1>#include &LTstdio.h>
</span><span style=color:#fdf4c1>void main(int argc, char* argv[]) {
</span><span style=color:#fdf4c1>	printf("argc: %d, argv[0]: %s\n", argc, argv[0]);
</span><span style=color:#fdf4c1>}
</span><span style=color:#fa5c4b>EOF
</span><span style=color:#fdf4c1>gcc example.c -o example
</span><span style=color:#fdf4c1>./example
</span><span style=font-style:italic;color:#928374># Output:
</span><span style=font-style:italic;color:#928374># argc: 1, argv[0]: ./example
</span></code></pre><p>Now, you could directly use this knowledge to biuld your command line application, but managing this flags and the value that are passed to the flags becomes difficult after a certain point, for this case C has functions that can be used.<h3 id=using-getopt>Using <code>getopt()</code></h3><p><code>getopt()</code> is a function from <code>unistd.h</code>. This function is used to parse single letter arguments which are followed by hyphen <code>-</code>.<p>eg.<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ ls -la
</span><span>	  </span><span style=color:#fdf4c1>^^
</span><span>	  </span><span style=color:#fe8019>|</span><span style=color:#b8bb26>\-</span><span style=color:#fdf4c1>- </span><span style=font-style:italic;color:#928374># Here `a` is a flag
</span><span>	  </span><span style=color:#b8bb26>\-</span><span style=color:#fdf4c1>-- </span><span style=font-style:italic;color:#928374># Here `l` is a flag
</span></code></pre><h4 id=how-to-implement-it>How to implement it</h4><p>We will take a program for example and then understand how it works<pre class=language-c data-lang=c style=background:#282828;color:#fdf4c1aa><code class=language-c data-lang=c><span style=color:#fa5c4b>#include </span><span style=color:#b8bb26>&LTstdio.h>
</span><span style=color:#fa5c4b>#include </span><span style=color:#b8bb26>&LTstdlib.h>
</span><span style=color:#fa5c4b>#include </span><span style=color:#b8bb26>&LTunistd.h>
</span><span>
</span><span style=color:#fa5c4b>int </span><span style=color:#8ec07c>main</span><span>(</span><span style=color:#fa5c4b>int </span><span style=color:#fdf4c1>argc</span><span>, </span><span style=color:#fa5c4b>char</span><span style=color:#fe8019>* </span><span style=color:#fdf4c1>argv</span><span>[]) {
</span><span>    </span><span style=color:#fa5c4b>extern char </span><span style=color:#fe8019>*</span><span>optarg;
</span><span>    </span><span style=color:#fa5c4b>extern int</span><span> optind;
</span><span>    </span><span style=color:#fa5c4b>int</span><span> out, err </span><span style=color:#fe8019>= </span><span style=color:#d3869b>0</span><span>;
</span><span>    </span><span style=color:#fa5c4b>int</span><span> lflag </span><span style=color:#fe8019>= </span><span style=color:#d3869b>0</span><span>, fflag </span><span style=color:#fe8019>= </span><span style=color:#d3869b>0</span><span>;
</span><span>    </span><span style=color:#fa5c4b>char </span><span style=color:#fe8019>*</span><span>fname;
</span><span>    </span><span style=color:#fa5c4b>static char</span><span> usage[] </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>"usage: </span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26> [-l] -f fname name\n"</span><span>;
</span><span>
</span><span>    </span><span style=color:#fa5c4b>while </span><span>((out </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>getopt(argc, argv, </span><span style=color:#b8bb26>"lf:"</span><span style=color:#fdf4c1>)</span><span>) </span><span style=color:#fe8019>!= -</span><span style=color:#d3869b>1</span><span>) {
</span><span>        </span><span style=color:#fa5c4b>switch </span><span>(out) {
</span><span>            </span><span style=color:#fa5c4b>case </span><span style=color:#b8bb26>'l'</span><span>:
</span><span>                lflag </span><span style=color:#fe8019>= </span><span style=color:#d3869b>1</span><span>;
</span><span>                </span><span style=color:#fa5c4b>break</span><span>;
</span><span>            </span><span style=color:#fa5c4b>case </span><span style=color:#b8bb26>'f'</span><span>:
</span><span>                fflag </span><span style=color:#fe8019>= </span><span style=color:#d3869b>1</span><span>;
</span><span>                fname </span><span style=color:#fe8019>=</span><span> optarg;
</span><span>                </span><span style=color:#fa5c4b>break</span><span>;
</span><span>            </span><span style=color:#fa5c4b>case </span><span style=color:#b8bb26>'?'</span><span>:
</span><span>                err </span><span style=color:#fe8019>= </span><span style=color:#d3869b>1</span><span>;
</span><span>                </span><span style=color:#fa5c4b>break</span><span>;
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#fa5c4b>if </span><span>(fflag </span><span style=color:#fe8019>== </span><span style=color:#d3869b>0</span><span>) {
</span><span>        </span><span style=color:#fabd2f>fprintf</span><span style=color:#fdf4c1>(stderr, </span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26>: missing -f option\n"</span><span style=color:#fdf4c1>, argv[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>])</span><span>;
</span><span>        </span><span style=color:#fabd2f>exit</span><span style=color:#fdf4c1>(</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>)</span><span>;
</span><span>    } </span><span style=color:#fa5c4b>else if </span><span>((optind </span><span style=color:#fe8019>+ </span><span style=color:#d3869b>1</span><span>) </span><span style=color:#fe8019>!=</span><span> argc) {
</span><span>        </span><span style=color:#fa5c4b>if </span><span>(optind </span><span style=color:#fe8019>==</span><span> argc) </span><span style=color:#fabd2f>fprintf</span><span style=color:#fdf4c1>(stderr, </span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26>: missing name\n"</span><span style=color:#fdf4c1>, argv[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>])</span><span>;
</span><span>        </span><span style=color:#fa5c4b>else </span><span style=color:#fabd2f>fprintf</span><span style=color:#fdf4c1>(stderr, </span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26>: more that one name provided\n"</span><span style=color:#fdf4c1>, argv[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>])</span><span>;
</span><span>        </span><span style=color:#fabd2f>fprintf</span><span style=color:#fdf4c1>(stderr, usage, argv[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>])</span><span>;
</span><span>        </span><span style=color:#fabd2f>exit</span><span style=color:#fdf4c1>(</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>)</span><span>;
</span><span>    } </span><span style=color:#fa5c4b>else if </span><span>(err) {
</span><span>        </span><span style=color:#fabd2f>fprintf</span><span style=color:#fdf4c1>(stderr, usage, argv[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>])</span><span>;
</span><span>        </span><span style=color:#fabd2f>exit</span><span style=color:#fdf4c1>(</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>)</span><span>;
</span><span>    }
</span><span>    </span><span style=color:#fa5c4b>if </span><span>(lflag) </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"-l was used\n"</span><span style=color:#fdf4c1>)</span><span>;
</span><span>    </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"</span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26> was provided for -f\n"</span><span style=color:#fdf4c1>, fname)</span><span>;
</span><span>    </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"name : </span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26>\n"</span><span style=color:#fdf4c1>, argv[optind])</span><span>;
</span><span>    </span><span style=color:#fa5c4b>return </span><span style=color:#d3869b>0</span><span>;
</span><span>}
</span></code></pre><p>Above is is a simple example which has a usage line similar to:<p><code>usage: ./example [-l] -f fname name</code><p>Where <code>-l</code> is an optional flag, where as -f is compulsary.<p>Now, lets understand the code:<h4 id=undestanding-the-code>Undestanding the code</h4><ul><li><p>The includes are done for the following reasons:</p> <ul><li><code>stdio.h</code>: I/O functionality like printf, fprintf, etc<li><code>stdlib.h</code>: standard C library for exit function, exit status codes, etc<li><code>unistd.h</code>: This has the implementation of <code>getopt()</code></ul><li><p>The main function has the command line arguments passed to it, as explained in the previous title.</p><li><p>Variables defined are as follows:</p> <ul><li><p><code>extern char *optarg</code>: This is for storing the values that are passed to a flag. Here for <code>-f</code> flag. Where this flag is recieved the variable points to the string that was passed to it.</p><li><p><code>extern int optind</code>: This is the index of the argument that is being parsed.</p><li><p><code>int out, err =0</code>: The out is for storing the current argument that is being parsed of -1 if EOArgument is reached. err is to check if any invaid flag is passed. it is used in the end of the switch statement.</p><li><p><code>int lflag = 0, fflag = 0</code>: This variables are for knowning if the flags were triggered. Here, in my case <code>-l or -f</code> are triggered or not. <code>char *fname</code> similarly this is for storing the argument passed to the <code>-f</code> flag.</p><li><p>The <code>usage</code> string is just for providing with a useful help if they want to know which flags are to be used and how, if any special cases. There is a syntax to write this as well, the flags present in the <code>[]</code> (squarebrackets) are representing the optional flags and the others show the compulsary flags or arguments</p></ul><li><p>In the while loop, is where the magic happens</p> <pre class=language-c data-lang=c style=background:#282828;color:#fdf4c1aa><code class=language-c data-lang=c><span>out </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>getopt(argc, argv, </span><span style=color:#b8bb26>"lf:"</span><span style=color:#fdf4c1>)
</span></code></pre> <p>​ Here the arguments that are passed to the main function are directly passed to the getopt function, with an extra argument. This extra argument is the schema for parsing the flags.</p> <p>​ Here, <code>"lf:"</code> means look for <code>-l</code> flag and look for <code>-f</code> flag with an argument <code>:</code>.</p> <p>​ eg. <code>abe:w:</code> here <code>-a and -b</code> are the flags (toggles) and <code>-e</code> and <code>-w</code> would expect an argument.</p> <p>There is no special way to tell if a argument is permanent of optional this can be checked after the while loop manually, well this is C after all 😅.</p> <p>​ Every time the variable <code>out</code> will hold the flag. and if it equals <code>-1</code> then there are no further flags to parse.</p><li><p>The switch case, this is where you parse the flags.</p> <p>​ As stated in the top <code>out</code> holds the flag name. Thus we are checking if the flag that is present is one of the desired one, if so the we say that the flag is triggered by setting the variable corresponding to the flag to <code>1</code> i.e. <code>true</code> <em>(Ain’t no boolean in C)</em>.</p> <ul><li><p><code>optarg</code>: The variable stores the string (<code>char *</code>) that is passed to the flags with <code>:</code> in front of them, in the schema in the point above.</p><li><p><code>case '?':</code> Now, we haven’t added <code>?</code> to the schema, then why are we looking for it.</p> <p>​ This cases tests if any flag other than those specified in the schema are passed. That’s why we are setting <code>err = 1</code>. We will use this variable to raise an exception in the future.</p></ul><li><p>Now, we do the error handling</p> <ul><li><p>We first look if the <code>-f</code> was triggered or not. if not triggered then we print the error message to the STDERR and then exit with a status code of <strong>1</strong>.</p><li><p>The second condition is used to check if the all the arguments are parsed.</p> <p>we are comparing the <code>optind</code> and <code>argc</code>.</p> <p><code>optind</code> points to the current argument that is being parsed. If it points to the unnamed variable if any left or it’s value would be equal to that of <code>argc</code>. This would mean that all the variables are parsed and no unnamed variable are left.</p><li><p>We also look for the <code>err</code> variable which is triggered if any unnamed flag is invoked.</p></ul><li><p>We are finally going for the implementation.</p> <p>At the end you can use the flags that are invoked how ever you want. Here i am just printing if the flag is invoked. But you can get creative.</p></ul><h2 id=future-of-cli>Future of CLI</h2><p>We were talking about C, but there are other languages with implement the command line interface much better that <code>getopt</code>. There are also other command line implementation in C, if you dig through the <a href=https://github.com/ rel=noopener target=_blank>internet</a>. But this is the default methods that are provided but the standard library (<code>unstd.h</code>).<p class=tagsData><a href=/tags/linux>/linux/</a> <a href=/tags/c>/C/</a> <a href=/tags/filesystem>/filesystem/</a> <a href=/tags/cli>/CLI/</a></main><footer><hr><div class=footContainer><div class=footLeft><p>Nishant Joshi</div><div class=footRight><p>/ĕn″jə-nîr′/</div></div></footer></div>