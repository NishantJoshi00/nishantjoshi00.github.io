<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Wireguard VPN for linux</title><meta content="Wireguard VPN for linux" name=title><meta content=Nishant name=author><meta content=website property=og:type><meta content=https://nishantjoshi00.github.io/blog/college/wireguard/ property=og:url><meta property=og:site_name><meta content="Wireguard VPN for linux" property=og:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nishantjoshi00.github.io/blog/college/wireguard/ property=twitter:url><meta content="Wireguard VPN for linux" property=twitter:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=twitter:image><link href=https://nishantjoshi00.github.io/blog/college/wireguard/ rel=canonical><link rel="shortcut icon" href=https://nishantjoshi00.github.io/favicon.ico type=image/x-icon><link href=https://nishantjoshi00.github.io/css/style.css rel=stylesheet><script defer src=https://nishantjoshi00.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><div class=themeSwitch><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#lightMode></use></svg></button><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#darkMode></use></svg></button></div></nav></header><main><div><a href=..>..</a>/<span class=metaData>wireguard</span></div><time datetime=2020-05-01>Published on: <span class=metaData>2020-05-01</span></time><h1>Wireguard VPN for linux</h1><h1 id=overview-of-wireguard>Overview of wireguard</h1><h2 id=what-is-wireguard>What is wireguard ?</h2><p>Wireguard is a new VPN client / server addition to the linux kernel for 5.6. This is a small but powerful VPN client / server which can be setup and implemented within no time. It is build over and similar to the concept of SSH and moch.<h2 id=installation>Installation</h2><p>Source: <a href=https://wireguard.com/install/ rel=noopener target=_blank>wireguard.com/install/</a><p>Those with kernel >= 5.6 you already got it. For Windows & Android users checkout their official website : <a href=https://nishantjoshi00.github.io/blog/college/wireguard/wireguard.com>wireguard.com</a><p>For linux there are couple of ways to install it<ul><li>install using the default package manager<li>compile for source (but why would you do that)</ul><h2 id=setting-up>Setting up</h2><p>There are two ways of setting up the wireguard VPN interface<ul><li>Through the configuration file<li>Through command line</ul><h3 id=through-command-line>Through command line</h3><ol><li><p>After installation is done, generation of private key for the tunneling is required</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ wg genkey </span><span style=color:#fe8019>></span><span style=color:#fdf4c1> private.key
</span><span style=font-style:italic;color:#928374># This generates the base64 encoded private key
</span><span style=color:#fdf4c1>$ chmod 600 private.key
</span><span style=font-style:italic;color:#928374># Securing it against any unwanted tampering
</span></code></pre><li><p>Setting up the network interface for the VPN</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ ip link add wg0 type wireguard
</span><span style=font-style:italic;color:#928374># It could be anything wg0 - wgn
</span></code></pre><li><p>Setting IP Address for the newly created interface</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ ip addr add </span><span style=color:#fe8019><</span><span style=color:#fdf4c1>ip-address</span><span style=color:#fe8019>></span><span style=color:#fdf4c1>/</span><span style=color:#fe8019><</span><span style=color:#fdf4c1>sn-mask</span><span style=color:#fe8019>></span><span style=color:#fdf4c1> dev wg0
</span><span style=font-style:italic;color:#928374># Here &LTsn-mask> : subnet mask
</span><span style=font-style:italic;color:#928374># wg0 is just the example you have to use the one specified in step 2
</span></code></pre><li><p>Configuring the interface</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ wg set wg0 private-key ./private.key
</span><span style=font-style:italic;color:#928374># This is the assign the private key to the interface
</span></code></pre><li><p>To start / stop the interface</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=font-style:italic;color:#928374># To start the interface
</span><span style=color:#fdf4c1>$ ip link set wg0 up
</span><span style=font-style:italic;color:#928374># To stop the interface
</span><span style=color:#fdf4c1>$ ip linke set wg0 down
</span></code></pre></ol><p>After this is done the configuration of the interface is done<p>Now, you might need to connect to someone’s private network, to do this we have to configure the peer for the interface, this can be done multiple times with multiple peers<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>wg set wg0 peer </span><span style=color:#fe8019><</span><span style=color:#fdf4c1>peer-pub-key</span><span style=color:#fe8019>></span><span style=color:#fdf4c1> allowed-ips </span><span style=color:#fe8019><</span><span style=color:#fdf4c1>ip-addr(with subnet mask</span><span>)</span><span style=color:#fe8019>></span><span> endpoint </span><span style=color:#fe8019><</span><span>current-ip</span><span style=color:#fe8019>></span><span>:</span><span style=color:#fe8019><</span><span>port</span><span style=color:#fe8019>>
</span><span style=font-style:italic;color:#928374># &LTpeer-pub-key> : This is the public key of the peer
</span><span style=font-style:italic;color:#928374># This can be generated by the peer after generating the private key
</span><span style=font-style:italic;color:#928374># Once he has his own private.key and interface configured, then
</span><span style=color:#fdf4c1>$ wg pubkey </span><span style=color:#fe8019><</span><span style=color:#fdf4c1> private.key </span><span style=color:#fe8019>></span><span style=color:#fdf4c1> public.key
</span><span style=font-style:italic;color:#928374># Here your could also provide the private key directly and get the public key
</span><span style=font-style:italic;color:#928374># $ echo &LTprivate-key> | wg pubkey
</span><span>
</span><span style=font-style:italic;color:#928374># This content of the file public.key is the public key
</span><span style=font-style:italic;color:#928374># &LTip-addr> : This is the last known ip address of the host in the private network with subnetmask
</span><span style=font-style:italic;color:#928374># &LTcurrent-ip>:&LTport> : This is the IP address of the peer which is accessable to us, generally the port : 51820 but it could be anything to check what the port of the peer is ask him to :
</span><span style=color:#fdf4c1>$ wg
</span><span style=font-style:italic;color:#928374># This output of the command contains the listening port for the peer's interface
</span><span style=font-style:italic;color:#928374># The endpoint is optional
</span></code></pre><hr><h3 id=using-configuration-file>Using configuration file</h3><p>Here we can generate a configuration file and then pass it to the wg command line interface, but there is a much better way, let’s see what that is:<ol><li><p>Go the the /etc/wireguard</p><li><p>Now, create a configuration file wg0.conf (<em>from wg0.conf - wgn.conf</em>)</p><li><p>Generate and copy a private key using the wg command</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ wg genkey
</span></code></pre><li><p>Let’s add content to the configuration file</p> <pre class=language-properties data-lang=properties style=background:#282828;color:#fdf4c1aa><code class=language-properties data-lang=properties><span style=color:#8ec07c>[ </span><span style=color:#b8bb26>Interface ]
</span><span style=color:#8ec07c>PrivateKey </span><span>= </span><span style=color:#b8bb26>&LTPrivate-key> # Generated in step 3
</span><span style=color:#8ec07c>ListenPort </span><span>= </span><span style=color:#b8bb26>51820 # It could be anything really, this is often used
</span><span>
</span><span style=color:#8ec07c>[ </span><span style=color:#b8bb26>Peer ] # This section can be used multiple times depending on the no. of peers
</span><span style=font-style:italic;color:#928374># This section can be ignored if you just want to setup the interface
</span><span style=color:#8ec07c>PublicKey </span><span>= </span><span style=color:#b8bb26>&LTpeer-pub-key> # This is explained in the CLI peer setup step above
</span><span style=color:#8ec07c>Endpoint </span><span>= </span><span style=color:#b8bb26>&LTcurrent-ip>:&LTport> # This is the ip of the peer the is visible to us (optional)
</span><span style=color:#8ec07c>AllowedIPs </span><span>= </span><span style=color:#b8bb26>&LTip-addr> # This is the last known IP of the peer in the private net
</span></code></pre><li><p>After saving this you can spin up the interface with a single command.</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ systemctl start wg-quick@wg0.service
</span><span style=font-style:italic;color:#928374># The wg0 -> can be replaced by the interface name you have choosen
</span></code></pre></ol><hr><h2 id=thank-you>Thank you</h2><p>source : <a href=https://nishantjoshi00.github.io/blog/college/wireguard/wireguard.com>wireguard.com</a><p class=tagsData><a href=/tags/linux>/linux/</a> <a href=/tags/vpn>/VPN/</a> <a href=/tags/blog>/blog/</a></main><footer><hr><div class=footContainer><div class=footLeft><p>Nishant Joshi</div><div class=footRight><p>/ĕn″jə-nîr′/</div></div></footer></div>