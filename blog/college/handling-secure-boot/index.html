<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Handling Secure Boot</title><meta content="Handling Secure Boot" name=title><meta content=Nishant name=author><meta content=website property=og:type><meta content=https://nishantjoshi00.github.io/blog/college/handling-secure-boot/ property=og:url><meta property=og:site_name><meta content="Handling Secure Boot" property=og:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://nishantjoshi00.github.io/blog/college/handling-secure-boot/ property=twitter:url><meta content="Handling Secure Boot" property=twitter:title><meta content=https://nishantjoshi00.github.io/favicon.ico property=twitter:image><link href=https://nishantjoshi00.github.io/blog/college/handling-secure-boot/ rel=canonical><link rel="shortcut icon" href=https://nishantjoshi00.github.io/favicon.ico type=image/x-icon><link href=https://nishantjoshi00.github.io/css/style.css rel=stylesheet><script defer src=https://nishantjoshi00.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><div class=themeSwitch><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#lightMode></use></svg></button><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://nishantjoshi00.github.io/icons.svg#darkMode></use></svg></button></div></nav></header><main><div><a href=..>..</a>/<span class=metaData>handling-secure-boot</span></div><time datetime=2020-05-20>Published on: <span class=metaData>2020-05-20</span></time><h1>Handling Secure Boot</h1><h1 id=handling-secure-boot>Handling Secure Boot</h1><h2 id=what-is-secure-boot>What is Secure Boot?</h2><p>Secure boot is a feature provided by many manufacturing companies, this feature is present inside the BIOS of your system. The prime goal of this feature is to check whether the bootloader that is being executed is safe (Key verified) of not.<h2 id=why-do-self-signing>Why do self-signing?</h2><p>Self-signing allows the user the sign manually which bootloaders are allowed to be executed, or to sign some binaries that you have created and you want to execute at boot time. It uses the MOK manager to adds the key as trusted signing agent.<h2 id=how-to-self-sign>How to Self-sign</h2><ol><li><p>Creating your own key, certificate to add</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ openssl req -new -x509 -newkey rsa:2048 -keyout MOK.key -out MOK.crt \
</span><span style=color:#fdf4c1>	-nodes -days 3650 -subj </span><span style=color:#b8bb26>"/CN: &LTYour Name>/"
</span><span style=color:#fdf4c1>$ openssl x509 -in MOK.crt -out MOK.cer
</span><span style=font-style:italic;color:#928374># &LTYour Name> : Enter your name
</span></code></pre> <p>Now there would be three files in the current folder <code>MOK.key, MOK.crt, MOK.cer</code></p> <blockquote><p>Here the <strong>MOK.key</strong> is very important and should be kept safe.</blockquote><li><p>Importing the certificate into the MOK manager</p> <pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ sudo mokutil --import MOK.cer
</span><span style=font-style:italic;color:#928374># Here you would be prompted for a input password.
</span><span style=font-style:italic;color:#928374># This password has further uses so do not forget it
</span></code></pre></ol><p>Here after, it depends on what you want to sign<hr><h3 id=signing-binaries>Signing Binaries</h3><p>This is a low risk easy to perform task, go to the directory where the binaries are stored<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>sbsign --key /path/to/MOK.key --cert /path/to/MOK.crt</span><span style=color:#b8bb26>\ </span><span style=color:#fdf4c1>--output </span><span style=color:#fe8019><</span><span style=color:#fdf4c1>ofilename</span><span style=color:#fe8019>></span><span style=color:#fdf4c1>.efi </span><span style=color:#fe8019><</span><span style=color:#fdf4c1>filename</span><span style=color:#fe8019>></span><span style=color:#fdf4c1>.efi
</span><span style=font-style:italic;color:#928374># Here the ofilename can be same as filename
</span><span style=font-style:italic;color:#928374># filename is the file you want to sign
</span></code></pre><hr><h3 id=signing-kernel-modules>Signing Kernel modules</h3><p>In alternative to signing binaries some times kernel modules can also cause the secure boot check to fail. Signing the kernel modules is as simple as signing any other binary.<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>$ kmodsign sha512 MOK.key MOK.cer module.ko module.ko
</span><span style=font-style:italic;color:#928374># here we are signing the module.ko using the MOK.key
</span></code></pre><hr><h2 id=alternatives-to-self-signing>Alternatives to self-signing</h2><p>Now, you must be wondering, are there any other alternatives to self signing, definitly!. But for thing alternatives you lose the freedom that is granted to you by the self-signing technique. The alternatives are<ul><li>shim<li>PreLoader</ul><p>There are other methods but shim it the one used in ubuntu to make it possible to boot into ubuntu even if the secure boot in on. i.e. because the ubuntu bootloader is signed by microsoft which grants to access to boot into the computer.<hr><h4 id=resources>Resources</h4><p>Please Do read this amazing blog post on<p>: <a href=https://nishantjoshi00.github.io/blog/college/handling-secure-boot/ubuntu.com/blog/how-to-sign-things-for-secure-boot>how-to-sign-things-for-secure-boot</a><hr><p>Done !!<p class=tagsData><a href=/tags/security>/security/</a> <a href=/tags/booting>/booting/</a> <a href=/tags/cryptography>/cryptography/</a></main><footer><hr><div class=footContainer><div class=footLeft><p>Nishant Joshi</div><div class=footRight><p>/ĕn″jə-nîr′/</div></div></footer></div>